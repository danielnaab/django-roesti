# django-roesti

`django-roesti` provides a `HashedModel`, a Django model whose primary key is a
hash of its contents. This enables efficient use of the database when you need to reference data by its identity while minimizing round trips to
the database, or encounter the same data often, and need to ensure that it
exists in your database without duplicating it.

Hashes are generated by converting values into Python immutable types and then
generating the md5 hash of its pickled value.

`HashedModels` that mantain references to other `HashedModels` are supported.

`django-roesti` has been tested with Python 3.6 and Django 1.9.

Pull requests welcome.

## Roesti?

A *RÃ¶sti* is a Swiss potato pancake, similar to hash browns. Get it?

## Usage Example

Hashes are calculated from the fields specified in `hash_fields`. Foreign keys
should be hashed on the ID value.

Given these models:

```python
from roesti.models import HashedModel


class TestModel(HashedModel):
    hash_fields = ['char_field_1', 'integer_field_1']

    char_field_1 = models.CharField(max_length=32)
    integer_field_1 = models.IntegerField()


class TestReferencesModel(HashedModel):
    hash_fields = ['test_model_1_id', 'test_model_2_id', 'integer_field_1']

    test_model_1 = models.ForeignKey(TestModel)
    test_model_2 = models.ForeignKey(TestModel)
    integer_field_1 = models.IntegerField()
```

You may confirm the existence of values in the database:

```python
my_models = TestModel.objects.ensure([{
    'char_field_1': 'field 1 value 1',
    'integer_field_1': 1
}, {
    'char_field_1': 'field 1 value 2',
    'integer_field_1': 2
}, {
    'char_field_1': 'field 1 value 3',
    'integer_field_1': 3
}])

my_reference_models = TestReferencesModel.objects.ensure({
    'test_model_1': {
        'char_field_1': 'field 1 value 1',
        'integer_field_1': 1
    },
    'test_model_2': {
        'char_field_2': 'field 1 value 2',
        'integer_field_1': 2
    },
    'integer_field_1': 3
})
```
